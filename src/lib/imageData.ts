import AdrenalinePotion from '../assets/data/Adrenaline_Potion.data.png';
import Affliction from '../assets/data/Affliction.data.png';
import AggressionPotion from '../assets/data/Aggression_Potion.data.png';
import AncientElvenRitualShard from '../assets/data/Ancient_Elven_Ritual_Shard.data.png';
import Anguish from '../assets/data/Anguish.data.png';
import AnimateDead from '../assets/data/Animate_Dead.data.png';
import Anticipation from '../assets/data/Anticipation.data.png';
import Antifire from '../assets/data/antifire_top.data.png';
import Antipoison from '../assets/data/Anti-poison_Active.data.png';
import Aura from '../assets/data/Aura.data.png';
import BalanceByForce from '../assets/data/balance_by_force-beta.data.png';
import Barricade from '../assets/data/Barricade.data.png';
import Berserk from '../assets/data/Berserk.data.png';
import BikArrows from '../assets/data/bik_arrows.data.png';
import BlackVirus from '../assets/data/Black_virus.data.png';
import BlackstoneArrows from '../assets/data/blackstone_arrows.data.png';
import Bloated from '../assets/data/bloated.data.png';
import BlueVirus from '../assets/data/Blue_virus.data.png';
import BonfireBoost from '../assets/data/Bonfire_Boost.data.png';
import ChronicleAttraction from '../assets/data/Chronicle_Attraction.data.png';
import CrystalMask from '../assets/data/Crystal_Mask.data.png';
import CrystalRain from '../assets/data/Crystal_Rain-minimal.data.png';
import Darkness from '../assets/data/Darkness.data.png';
import DeathGuard from '../assets/data/Death_Guard_Special-top.data.png';
import DeathMark from '../assets/data/Death_Mark.data.png';
import DeathSpark from '../assets/data/Death_Spark.data.png';
import DeathsSwiftness from '../assets/data/Deaths_Swiftness-top.data.png';
import DeathsporeArrows from '../assets/data/deathspore_arrows.data.png';
import DeflectMagic from '../assets/data/Deflect_Magic.data.png';
import DeflectMelee from '../assets/data/Deflect_Melee.data.png';
import DeflectNecromancy from '../assets/data/Deflect_Necromancy.data.png';
import DeflectRanged from '../assets/data/Deflect_Ranged.data.png';
import DemonSlayer from '../assets/data/Demon_Slayer.data.png';
import Desolation from '../assets/data/Desolation.data.png';
import Devotion from '../assets/data/Devotion.data.png';
import DiamondBakBolts from '../assets/data/diamond_bak_bolts.data.png';
import Divert from '../assets/data/Divert.data.png';
import DragonSlayer from '../assets/data/Dragon_Slayer.data.png';
import DwarfWeedIncense from '../assets/data/Dwarf_Weed.data.png';
import EnhancedExcalibur from '../assets/data/Enhanced_Excalibur-scuffed.data.png';
import ElderOverload from '../assets/data/Elder_Overload.data.png';
import ErethdorsGrimoire from '../assets/data/Erethdor\'s_grimoire.data.png';
import FellstalkIncense from '../assets/data/Fellstalk.data.png';
import Freedom from '../assets/data/Freedom.data.png';
import FulArrows from '../assets/data/ful_arrows.data.png';
import GladiatorsRage from '../assets/data/Gladiators_Rage.data.png';
import GreaterDeathsSwiftness from '../assets/data/Greater_Death\'s_Swiftness.data.png';
import GreaterSunshine from '../assets/data/Greater_Sunshine.data.png';
import GreenVirus from '../assets/data/Green_virus.data.png';
import HydrixBakBolts from '../assets/data/hydrix_bak_bolts.data.png';
import Immortality from '../assets/data/Immortality.data.png';
import IngenuityOfTheHumans from '../assets/data/Ingenuity_of_the_Humans.data.png';
import Instability from '../assets/data/Instability.data.png';
import InvokeLordOfBones from '../assets/data/Invoke_Lord_of_Bones.data.png';
import JasDragonbaneArrows from '../assets/data/jas_dragonbane.data.png';
import KwuarmIncense from '../assets/data/Kwuarm.data.png';
import LantadymeIncense from '../assets/data/Lantadyme.data.png';
import Limitless from '../assets/data/Limitless.data.png';
import LivingDeath from '../assets/data/Living_Death.data.png';
import Malevolence from '../assets/data/Malevolence.data.png';
import Necrosis from '../assets/data/Necrosis.data.png';
import OmniGuard from '../assets/data/Omni_Guard_Special-top.data.png';
import OnyxBakBolts from '../assets/data/onyx_bak_bolts.data.png';
import Overloaded from '../assets/data/Overloaded.data.png';
import PerfectEquilibrium from '../assets/data/Perfect_Equilibrium.data.png';
import PerfectEquilibriumCapped from '../assets/data/perfect_equilibrium_capped.data.png';
import Poisonous from '../assets/data/Poisonous-top.data.png';
import PowderOfPenance from '../assets/data/powder_of_penance.data.png';
import PowderOfProtection from '../assets/data/powder_of_protection.data.png';
import PowerburstPrevention from '../assets/data/Powerburst_prevention.data.png';
import PrayerActive from '../assets/data/Prayer_active.data.png';
import PrayerRenewal from '../assets/data/Prayer_Renew_Active.data.png';
import ProtectFromMagic from '../assets/data/Protect_from_Magic.data.png';
import ProtectFromMelee from '../assets/data/Protect_from_Melee.data.png';
import ProtectFromNecromancy from '../assets/data/Protect_from_Necromancy.data.png';
import ProtectFromRanged from '../assets/data/Protect_from_Ranged.data.png';
import PutridZombie from '../assets/data/putrid_zombie-top.data.png';
import RedVirus from '../assets/data/Red_virus.data.png';
import Reflect from '../assets/data/Reflect.data.png';
import ResidualSoul from '../assets/data/Residual_Soul.data.png';
import Resonance from '../assets/data/Resonance.data.png';
import RubyBakBolts from '../assets/data/ruby_bak_bolts.data.png';
import Ruination from '../assets/data/Ruination.data.png';
import SerenGodbow from '../assets/data/Seren_Godbow_Special-top.data.png';
import SignOfLife from '../assets/data/Sign_of_Life-top.data.png';
import SkeletonWarrior from '../assets/data/skeleton_warrior-top.data.png';
import Sorrow from '../assets/data/Sorrow.data.png';
import SoulSplit from '../assets/data/Soul_Split.data.png';
import SplitSoul from '../assets/data/Split_Soul.data.png';
import SplitSoulECB from '../assets/data/split_soul_ecb.data.png';
import Stunned from '../assets/data/Stunned.data.png';
import Sunshine from '../assets/data/Sunshine.data.png';
import SuperAntifire from '../assets/data/Super_Anti-Fire_Active.data.png';
import SupremeOverload from '../assets/data/supreme_overload.data.png';
import ThreadsOfFate from '../assets/data/Threads_of_Fate.data.png';
import TimeRift from '../assets/data/Time_rift.data.png';
import Torment from '../assets/data/Torment.data.png';
import Turmoil from '../assets/data/Turmoil.data.png';
import UndeadSlayer from '../assets/data/Undead_Slayer.data.png';
import VengefulGhost from '../assets/data/vengeful_ghost-top.data.png';
import Vulnerability from '../assets/data/Vulnerability_bordered.data.png';
import WenArrows from '../assets/data/wen_arrows.data.png';

const rawImageMap: Record<string, string> = {
    'Adrenaline Potion': AdrenalinePotion,
    'Affliction': Affliction,
    'Aggression Potion': AggressionPotion,
    'Ancient Elven Ritual Shard': AncientElvenRitualShard,
    'Anguish': Anguish,
    'Animate Dead': AnimateDead,
    'Anticipation': Anticipation,
    'Antifire': Antifire,
    'Antipoison': Antipoison,
    'Aura': Aura,
    'Balance By Force': BalanceByForce,
    'Barricade': Barricade,
    'Berserk': Berserk,
    'Bik Arrows': BikArrows,
    'BlackVirus': BlackVirus,
    'Blackstone Arrows': BlackstoneArrows,
    'Bloated': Bloated,
    'Blue Virus': BlueVirus,
    'Bonfire Boost': BonfireBoost,
    'Chronicle Attraction': ChronicleAttraction,
    'Crystal Mask': CrystalMask,
    'Crystal Rain': CrystalRain,
    'Darkness': Darkness,
    'Death Guard': DeathGuard,
    'Death Mark': DeathMark,
    'Death Spark': DeathSpark,
    'Deaths Swiftness': DeathsSwiftness,
    'Deathspore Arrows': DeathsporeArrows,
    'Deflect Magic': DeflectMagic,
    'Deflect Melee': DeflectMelee,
    'Deflect Necromancy': DeflectNecromancy,
    'Deflect Ranged': DeflectRanged,
    'Demon Slayer': DemonSlayer,
    'Desolation': Desolation,
    'Devotion': Devotion,
    'Diamond Bak Bolts': DiamondBakBolts,
    'Divert': Divert,
    'Dragon Slayer': DragonSlayer,
    'DwarfWeed Incense': DwarfWeedIncense,
    'Enhanced Excalibur': EnhancedExcalibur,
    'Elder Overload': ElderOverload,
    'Erethdors Grimoire': ErethdorsGrimoire,
    'Fellstalk Incense': FellstalkIncense,
    'Freedom': Freedom,
    'Ful Arrows': FulArrows,
    'Gladiators Rage': GladiatorsRage,
    'Greater Deaths Swiftness': GreaterDeathsSwiftness,
    'Greater Sunshine': GreaterSunshine,
    'Green Virus': GreenVirus,
    'Hydrix Bak Bolts': HydrixBakBolts,
    'Immortality': Immortality,
    'Ingenuity of the Humans': IngenuityOfTheHumans,
    'Instability': Instability,
    'Invoke Lord of Bones': InvokeLordOfBones,
    'Jas Dragonbane Arrows': JasDragonbaneArrows,
    'Kwuarm Incense': KwuarmIncense,
    'Lantadyme Incense': LantadymeIncense,
    'Limitless': Limitless,
    'LivingDeath': LivingDeath,
    'Malevolence': Malevolence,
    'Necrosis': Necrosis,
    'OmniGuard': OmniGuard,
    'Onyx Bak Bolts': OnyxBakBolts,
    'Overloaded': Overloaded,
    'Perfect Equilibrium': PerfectEquilibrium,
    'Perfect Equilibrium (capped)': PerfectEquilibriumCapped,
    'Powder of Penance': PowderOfPenance,
    'Powder of Protection': PowderOfProtection,
    'Powerburst Prevention': PowerburstPrevention,
    'Prayer Active': PrayerActive,
    'Prayer Renewal': PrayerRenewal,
    'Protect From Magic': ProtectFromMagic,
    'Protect From Melee': ProtectFromMelee,
    'Protect From Necromancy': ProtectFromNecromancy,
    'Protect From Ranged': ProtectFromRanged,
    'Putrid Zombie': PutridZombie,
    'Red Virus': RedVirus,
    'Reflect': Reflect,
    'Residual Soul': ResidualSoul,
    'Resonance': Resonance,
    'Ruby Bak Bolts': RubyBakBolts,
    'Ruination': Ruination,
    'Seren Godbow': SerenGodbow,
    'Sign of Life': SignOfLife,
    'Skeleton Warrior': SkeletonWarrior,
    'Sorrow': Sorrow,
    'Soul Split': SoulSplit,
    'Split Soul': SplitSoul,
    'Split Soul (ECB)': SplitSoulECB,
    'Stunned': Stunned,
    'Sunshine': Sunshine,
    'Super Antifire': SuperAntifire,
    'Supreme Overload': SupremeOverload,
    'Threads of Fate': ThreadsOfFate,
    'TimeRift': TimeRift,
    'Torment': Torment,
    'Turmoil': Turmoil,
    'Undead Slayer': UndeadSlayer,
    'Vengeful Ghost': VengefulGhost,
    'Vulnerability': Vulnerability,
    'Weapon Poison': Poisonous,
    'Wen Arrows': WenArrows
  };

  
const encodedImageCache = new Map<string, Promise<string>>();

/**
 * Returns a Promise resolving to the encoded 8-bit string suitable for alt1.overLayImage.
 */
export function getEncodedImageForBuff(buffName: string, a1lib: any): Promise<string> {
  if (encodedImageCache.has(buffName)) {
    return encodedImageCache.get(buffName)!;
  }

  const imgSrc = rawImageMap[buffName];
  if (!imgSrc) return Promise.reject(new Error(`No image found for buff: ${buffName}`));

  const promise = new Promise<string>((resolve, reject) => {
    const img = new Image();
    img.crossOrigin = 'anonymous'; // in case of CORS issues
    img.onload = () => {
      const canvas = document.createElement('canvas');
      canvas.width = img.width;
      canvas.height = img.height;
      const ctx = canvas.getContext('2d');
      if (ctx === null) return;
      ctx.drawImage(img, 0, 0);
      const imageData = ctx.getImageData(0, 0, img.width, img.height);
      const encoded = a1lib.encodeImageString(imageData); // 8-bit string
      resolve(encoded);
    };
    img.onerror = () => reject(new Error(`Failed to load image for buff: ${buffName}`));
    img.src = imgSrc;
  });

  encodedImageCache.set(buffName, promise);
  return promise;
}